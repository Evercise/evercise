function redirectTo(e){window.location.href=e.url}function editClass(e){$("#"+e.id).html(e.view),$("#edit-"+e.id).removeClass("disabled"),$("#submit-"+e.id).hide(),$("#"+e.id).parent().collapse("show"),$("#infoToggle-"+e.id).removeClass("hide"),datepick()}function updateHubRow(e){$("#hub-edit-row-"+e.id).after(e.view)}function newSessionAdded(e){$("#"+e.id).html(e.view),addSession(),datepick()}function removeSessionRow(e){$("#update-row-"+e.id).remove(),$("#update-id-"+e.id).remove()}
if("undefined"!=typeof angular){var app=angular.module("DiscoverApp",["google-maps".ns(),"infinite-scroll","ngSanitize"]);app.config(["GoogleMapApiProvider".ns(),function(n){n.configure({v:"3.16",libraries:"weather,geometry,visualization"})}]),app.filter("truncate",function(){return function(n,e,r){return isNaN(e)&&(e=10),void 0===r&&(r="..."),n.length<=e||n.length-r.length<=e?n:String(n).substring(0,e-r.length)+r}}),app.filter("repeat",function(){return function(n,e){e=parseInt(e);for(var r=0;e>r;r++)n.push(r);return n}})}
function datepick(){$(".date-picker").datepicker({format:"yyyy-mm-dd",startDate:"+1d",autoclose:!0,todayHighlight:!0})}$.fn.exists=function(t){var a=[].slice.call(arguments,1);return this.length&&t.call(this,a),this};
$.ajaxSetup({headers:{"X-CSRF-Token":TOKEN}}),$(function(){$(".navbar").exists(function(){new Navigation(this,$(".hero-nav-change"),$(".sticky-fixed-nav"))}),$(".masonry").exists(function(){new Masonry(this)}),$("#user-nav-bar").exists(function(){new Profile(this)}),$(".toggle-switch").exists(function(){$(document).on("click",".toggle-switch",function(e){new ToggleSwitch($(e.target))})}),$(".map_canvas").exists(function(){map=new Map(this)}),$(".mb-scroll").exists(function(){$(this).mCustomScrollbar({scrollSpeed:10,autoHideScrollbar:!0})}),$(".holder").exists(function(){new ImagePlaceholder}),$("#register-form").exists(function(){new Validation(this)}),$(".class-preview").exists(function(){new PreviewClassBox(this)}),$(".hide-by-class").exists(function(){var e=0;$(".hide-by-class").each(function(){var s=this;$("."+$(this).attr("href").substr(1)).exists(function(){0==e&&($(s).addClass("active"),$(this).removeClass("hide")),$(s).removeClass("disabled"),e++})}),this.click(function(){$(".hide-by-class").removeClass("active"),$(this).addClass("active"),$(".hide-by-class-element").addClass("hide"),$("."+$(this).attr("href").substr(1)).removeClass("hide")})}),$("#login-form").exists(function(){login=this,$(document).on("submit",login,function(e){e.preventDefault(),new AjaxRequest(login,redirectTo)})}),$(".edit-class-inline").exists(function(){$(document).on("submit",".edit-class-inline",function(e){e.preventDefault(),$(e.target).find(".btn-toggle-down").addClass("loading"),new AjaxRequest($(e.target),editClass)}),$(document).on("submit",".add-session",function(e){e.preventDefault(),new AjaxRequest($(e.target),newSessionAdded)}),$(document).on("submit",".update-session",function(e){e.preventDefault(),new AjaxRequest($(e.target),updateHubRow)}),$(document).on("submit",".remove-session",function(e){e.preventDefault(),new AjaxRequest($(e.target),removeSessionRow)})}),$(document).on("submit",".remove-session",function(e){e.preventDefault(),new AjaxRequest($(e.target),removeSessionRow)}),$(".dropdown-cart").exists(function(){cart=new Cart(this)}),$("#find_gallery_image_by_category").exists(function(){new categorySelect($(this))}),$("#image-cropper").exists(function(){new imageCropper(this)}),$("#create-venue").exists(function(){new createVenue(this)}),$("#add-session").exists(function(){new AddSessions(this)}),$("#update-sessions").exists(function(){new UpdateSessions(this)}),$("#create-class").exists(function(){new createClass(this)}),$("#preview").exists(function(){new previewBox(this)})});
var Validation=function(a){this.form=a,this.validIcon="glyphicon glyphicon-ok",this.invalidIcon="glyphicon glyphicon-remove",this.validatingIcon="glyphicon glyphicon-refresh",this.displayName={message:"Your username is not valid",validators:{notEmpty:{message:"Your display name is required"},stringLength:{min:5,max:20,message:"Your display name must be more than 5 and less than 20 characters long"},regexp:{regexp:/^[a-zA-Z0-9_]+$/,message:"Your display name can only consist of alphabetical, number and underscore"}}},this.email={validators:{notEmpty:{message:"Your email is required and cannot be empty"},emailAddress:{message:"Your email is not a valid email address"}}},this.first_name={validators:{notEmpty:{message:"Your first name is required and cannot be empty"},stringLength:{min:2,max:15,message:"Your first name must be more than 2 and less than 15 characters long"}}},this.last_name={validators:{notEmpty:{message:"Your surname is required and cannot be empty"},stringLength:{min:2,max:15,message:"Your surname must be more than 2 and less than 15 characters long"}}},this.password={validators:{notEmpty:{message:"Your password is required and cannot be empty"},stringLength:{min:6,max:32,message:"Your Password must be more than 6 and less than 32 characters long"},identical:{field:"confirmed_password",message:"Your passwords do not match"}}},this.confirmed_password={validators:{notEmpty:{message:"Your password is required and cannot be empty"},stringLength:{min:6,max:32,message:"Your Password must be more than 6 and less than 32 characters long"},identical:{field:"password",message:"Your passwords do not match"}}},this.init()};Validation.prototype={constructor:Validation,init:function(){this.form.find("input[type='submit']").prop("disabled",!0),this.validation()},validation:function(){this.form.bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:this.validIcon,invalid:this.invalidIcon,validating:this.validatingIcon},fields:{display_name:this.displayName,email:this.email,first_name:this.first_name,last_name:this.last_name,password:this.password,confirmed_password:this.confirmed_password}}).on("success.form.bv",function(a){a.preventDefault(),new AjaxRequest($(a.target),redirectTo)})}};
"undefined"!=typeof angular&&app.controller("DiscoverController",["$scope","$q",function(e){function i(e){$(".class-snippet").addClass("fade-out"),$(".class-snippet").removeClass("active"),$(e).addClass("active"),$(".mb-scroll").mCustomScrollbar("scrollTo",e,{scrollInertia:500,timeout:10})}e.everciseGroups=laracasts.mapResults,e.view="mapview",e.sort="id",e.changeView=function(i){e.view=i},e.isPreviewOpen=!1,e.map={center:{latitude:50,longitude:-1},pann:{},options:{streetViewControl:!1,maxZoom:20,minZoom:3},zoom:12},e.results=e.everciseGroups.length,e.myMarkers=[],e.clusterStyles=[{textColor:"white",url:"/assets/img/icon_default_small_pin_number.png",height:43,width:33,anchorText:[-14,9]},{textColor:"white",url:"/assets/img/icon_default_large_pin_number.png",height:66,width:51,anchorText:[-22,14]}],e.clusterOptions={gridSize:8,maxZoom:20,zoom:15,styles:e.clusterStyles},e.mask=!1,e.initialLoad=e.everciseGroups.length<200?e.everciseGroups.length:200,e.markers=[];var t=function(i){var t={id:i.id,name:i.name,image:"/profiles/"+i.user.directory+"/"+i.image,latitude:i.venue.lat,longitude:i.venue.lng,icon:"/assets/img/icon_default_small_pin.png",price:i.default_price,rating:i.ratings.length,description:i.description,stars:e.getStars(i.ratings),capacity:i.capacity,sessions:i.futuresessions,nextClassDate:new Date(i.futuresessions[0].date_time),nextClassDuration:i.futuresessions[0].duration,link:"/class/"+i.id,click:function(){e.clicked(this.model)}};return t};e.clusterEvents={click:function(i,t){angular.forEach(t,function(i){e.clicked(i)})}},e.returnPreview=function(){e.isPreviewOpen=!1},e.lastActiveMarker="",e.clicked=function(t){e.isPreviewOpen=!0,e.preview.id="preview-"+t.id,e.preview.image="url('"+t.image+"')",e.preview.description=t.description,e.preview.nextClassDate=new Date(t.sessions[0].date_time),e.preview.nextClassDuration=t.sessions[0].duration,e.preview.capacity=t.capacity,e.preview.link=t.link,e.lastActiveMarker.icon="/assets/img/icon_default_small_pin.png",e.lastActiveMarker=t,t.icon="/assets/img/icon_default_large_pin.png",e.map.pan={latitude:t.latitude,longitude:t.longitude},e.map.center={latitude:t.latitude,longitude:t.longitude},e.map.zoom=15,e.mask=!0,i("#"+t.id)},e.getStars=function(e){var i=0;if(e.length>0){for(var t=0;t<e.length;t++)i+=e[t].stars;result=Math.round(i/e.length)}else result=0;return result},e.preview={id:1,image:"",description:"",nextClassDate:"",nextClassDuration:"",capacity:"",link:""},e.$watch(function(){return e.map.bounds},function(){for(var i=0;i<e.initialLoad;i++)e.myMarkers.push(t(e.everciseGroups[i]));e.markers=e.myMarkers},!0)}]);
var Navigation=function(s,t,i){this.nav=s,this.hero=t,this.sticky=i,this.stickyTop=0,this.height=s.height(),this.heroClass="nav-hero",this.scroll=0,this.init(),this.checkScrollPosition()};Navigation.prototype={constructor:Navigation,init:function(){this.hero.length>0&&this.addHeroClass(),this.sticky.length>0&&(this.stickyTop=this.sticky.offset().top,this.stick())},addHeroClass:function(){this.nav.addClass(this.heroClass)},removeHeroClass:function(){this.nav.removeClass(this.heroClass)},addStickyClass:function(){this.sticky.addClass("navbar-fixed-top"),this.sticky.css({top:this.height}),$(".sticky-wrapper").css({"margin-top":this.sticky.outerHeight(!0)})},removeStickyClass:function(){this.sticky.removeClass("navbar-fixed-top"),this.sticky.css({top:0}),$(".sticky-wrapper").css({"margin-top":0})},checkScrollPosition:function(){var s=this;$(window).scroll(function(){s.scroll=$(window).scrollTop(),s.stick(),s.scroll+s.height>=s.hero.outerHeight()?s.removeHeroClass():s.addHeroClass()})},stick:function(){var s=this;s.scroll>s.stickyTop-this.sticky.outerHeight(!0)?s.addStickyClass():s.removeStickyClass()}};
function imageCropper(t){this.elem=t,this.modal=this.elem.find(".modal-cropper"),this.modalImage=this.modal.find("#uploaded-image"),this.uploadForm=this.elem.find("#image-upload-form"),this.galleryRow=$("#gallery-row"),this.galleryImage="",this.galleryValue="",this.croppedForm=this.modal.find("#cropped-image"),this.uploadButton=this.modal.find("input[name='file']"),this.imageSelect=this.uploadForm.find(".image-select"),this.image=this.modal.find(".bootstrap-modal-cropper img"),this.xInput=this.modal.find("input[name='x']"),this.yInput=this.modal.find("input[name='y']"),this.wInput=this.modal.find("input[name='width']"),this.hInput=this.modal.find("input[name='height']"),this.bwInput=this.modal.find("input[name='box_width']"),this.bhInput=this.modal.find("input[name='box_height']"),this.originalData={},this.ratio=2.35,this.x=0,this.y=0,this.w=0,this.h=0,this.bw=0,this.bh=0,this.init()}imageCropper.prototype={constructor:imageCropper,init:function(){this.addListener()},addListener:function(){$(document).on("click",".image-select",$.proxy(this.upload,this)),this.uploadButton.on("change",$.proxy(this.getImage,this)),this.galleryRow.on("change",$.proxy(this.updatedRow,this)),this.modalImage.on("load",$.proxy(this.openModal,this)),this.modal.on("shown.bs.modal",$.proxy(this.crop,this)),this.modal.on("hidden.bs.modal",$.proxy(this.destroyCrop,this)),this.croppedForm.on("submit",$.proxy(this.submitForm,this)),$(document).on("click",".gallery-option",$.proxy(this.clickGalleryOption,this))},upload:function(){this.uploadButton.trigger("click")},getImage:function(t){if(self=this,t.target.files&&t.target.files[0]){var i=new FileReader;i.onload=function(t){self.modalImage.attr("src",t.target.result)},i.readAsDataURL(t.target.files[0])}},openModal:function(){this.modal.modal("show")},closeModal:function(){this.modal.modal("hide")},crop:function(){self=this,this.image=this.modal.find(".bootstrap-modal-cropper img"),this.image.cropper({data:this.originalData,aspectRatio:this.ratio,done:function(t){self.x=t.x,self.y=t.y,self.w=t.width,self.h=t.height}})},destroyCrop:function(){this.image.cropper("destroy"),self.modalImage.attr("src",null),this.uploadButton.val("")},submitForm:function(t){t.preventDefault(),this.bw=this.image.cropper("getImageData").width,this.bh=this.image.cropper("getImageData").height,this.xInput.val(this.x),this.yInput.val(this.y),this.wInput.val(this.w),this.hInput.val(this.h),this.bwInput.val(this.bw),this.bhInput.val(this.bh),this.ajaxUpload()},ajaxUpload:function(){var t=this.croppedForm.attr("action"),i=new FormData(this.croppedForm[0]),a=this;$.ajax(t,{type:"post",data:i,processData:!1,contentType:!1,beforeSend:function(){a.croppedForm.find("input[type='submit']").prop("disabled",!0).after('<span id="cropping-loading" class="icon icon-loading ml10"></span>'),a.image.cropper("disable")},success:function(t){a.galleryValue=t.file,a.galleryImage='<img src="/'+t.file+'" alt="cover photo" class="img-responsive">',a.croppedForm.find("input[type=submit]").prop("disabled",!1),a.uploadForm.append(a.galleryImage),$("#first-img").html(a.galleryImage),$("#first-img").append('<div class="holder-add-more"><span class="image-select icon-lg icon-md-camera hover"></span>'),$('input[name="image"]').val(a.galleryValue).trigger("change")},error:function(t,i,a){console.log(t+" - "+i+" - "+a)},complete:function(){$("#cropping-loading").remove(),a.closeModal()}})},clickGalleryOption:function(t){this.galleryValue=$(t.target).attr("src"),this.uploadForm.append('<img src="'+this.galleryValue+'" alt="cover image" class="img-responsive">'),$('input[name="image"]').val(this.galleryValue).trigger("change")},updatedRow:function(){""!=this.galleryImage&&($("#first-img").html(this.galleryImage),$("#first-img").append('<div class="holder-add-more"><span class="image-select icon-lg icon-md-camera hover"></span>'))}};
function createVenue(e){this.container=e,this.form=e.find("#create_venue"),this.next=this.form.find(".next"),this.validIcon="glyphicon glyphicon-ok",this.invalidIcon="glyphicon glyphicon-remove",this.validatingIcon="glyphicon glyphicon-refresh",this.venueName={message:"Your Venue is not valid",validators:{notEmpty:{message:"Your Venue requires a name"},stringLength:{min:2,max:50,message:"Your Venue name must be more than 2 and less than 50 characters long"}}},this.venueStreet={message:"Your street is not valid",validators:{notEmpty:{message:"Your Venue requires a street"},stringLength:{min:2,max:50,message:"Your street name must be more than 2 and less than 50 characters long"}}},this.town={message:"Your town is not valid",validators:{notEmpty:{message:"Your Venue requires a town"},stringLength:{min:2,max:50,message:"Your town name must be more than 2 and less than 50 characters long"}}},this.venuePC={message:"Your post code is not valid",validators:{notEmpty:{message:"Your Venue requires a post code"},stringLength:{min:6,max:8,message:"Your post code must be more than 6 and less than 8 characters long"}}},this.init()}createVenue.prototype={constuctor:createVenue,init:function(){this.addListener(),this.validation(),this.form.find("input[type='submit']").prop("disabled",!0)},addListener:function(){this.next.on("click",$.proxy(this.switchTab,this))},switchTab:function(e){e.preventDefault();var t=$(e.target).data("target");$("#"+t+"-pill").click()},validation:function(){var e=this;$(this.form).bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:this.validIcon,invalid:this.invalidIcon,validating:this.validatingIcon},fields:{name:this.venueName,address:this.venueStreet,town:this.town,postcode:this.venuePC}}).on("success.form.bv",function(t){t.preventDefault(),e.ajaxUpload()})},ajaxUpload:function(){var e=this;$.ajax(e.form.attr("action"),{type:"post",data:e.form.serialize(),dataType:"json",beforeSend:function(){e.form.find("input[type='submit']").prop("disabled",!0).after('<span id="venue-loading" class="icon icon-loading ml10"></span>')},success:function(t){e.form.find("input[type=submit]").prop("disabled",!1),$("#venue_select").append($("<option />",{text:t.venue_name,value:t.venue_id,selected:!0}))},error:function(e,t,n){console.log(e+" - "+t+" - "+n)},complete:function(){$("#venue-loading").remove(),e.container.modal("hide")}})}};
function categorySelect(e){this.form=e,this.select=this.form.find(".select2"),this.keywordSelect=this.form.find('input[name="keywords"]'),this.keywords=[],this.keys=[],this.gallery="",this.maximumSelectionSize=3,this.minimumResultsForSearch=1,this.placeholder="Choose upto 3 categories",this.dropdownCssClass="select2-hidden",this.init()}categorySelect.prototype={constructor:categorySelect,init:function(){this.select.select2({maximumSelectionSize:this.maximumSelectionSize,minimumResultsForSearch:this.minimumResultsForSearch,placeholder:this.placeholder,closeOnSelect:!0,openOnEnter:!1,formatNoMatches:function(){return""},dropdownCssClass:this.dropdownCssClass}),this.addListener()},addListener:function(){this.form.on("submit",$.proxy(this.submitForm,this)),this.select.on("select2-selecting",$.proxy(this.addToKeywords,this)),this.select.on("select2-removing",$.proxy(this.removeFromKeywords,this))},submitForm:function(e){e.preventDefault(),this.ajaxUpload()},ajaxUpload:function(){var e=this;$.ajax(e.form.attr("action"),{type:"post",data:e.form.serialize(),dataType:"json",beforeSend:function(){e.select.prop("disabled",!0),$("#gallery-row").after('<div id="gallery-loading"  class="alert alert-success text-center"><span class="icon icon-loading ml10"></span> Loading gallery based on your selected categories...</div>')},success:function(t){e.gallery=t.view,$("#gallery-row").html(e.gallery).trigger("change")},error:function(e,t,s){console.log(e+" - "+t+" - "+s)},complete:function(){e.select.prop("disabled",!1),$("#gallery-loading").remove()}})},addToKeywords:function(e){this.keys.push(e.choice.id),this.keywords.push(e.choice.text),this.keywordSelect.val(this.keywords),this.updateCategoriesInput(),this.form.submit()},removeFromKeywords:function(e){this.keywords=$.grep(this.keywords,function(t){return t!=e.choice.text}),this.keys=$.grep(this.keys,function(t){return t!=e.choice.id}),this.updateCategoriesInput()},updateCategoriesInput:function(){$('input[name="category_array[]"]').val(this.keys).trigger("change")}};
function createClass(a){this.form=a,this.validIcon="glyphicon glyphicon-ok",this.invalidIcon="glyphicon glyphicon-remove",this.validatingIcon="glyphicon glyphicon-refresh",this.className={validators:{notEmpty:{message:"Your class name is required"},stringLength:{min:3,max:50,message:"Your class name must be more than 3 and less than 50 characters long"}}},this.classDescription={validators:{notEmpty:{message:"Your class needs a description"},stringLength:{min:50,max:500,message:"Your class description must be more than 50 and less than 500 characters long"}}},this.init()}createClass.prototype={constructor:createClass,init:function(){this.validation(),this.addListener()},addListener:function(){$(document).on("change",'input[name="image"]',$.proxy(this.reValidate,this)),$(document).on("change",'input[name="category_array[]"]',$.proxy(this.reValidate,this))},validation:function(){var a=this;$(this.form).on("init.form.bv",function(a,t){t.bv.disableSubmitButtons(!0)}).bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:this.validIcon,invalid:this.invalidIcon,validating:this.validatingIcon},fields:{class_name:this.className,class_description:this.classDescription}}).on("success.field.bv",function(){$("input[name='image']").val()||$("input[name='category_array[]']").val()||a.form.find("input[type='submit']").prop("disabled",!0)}).on("success.form.bv",function(t){t.preventDefault(),$("input[name='image']").val()?$("input[name='category_array[]']").val()?(a.form.find("input[type='submit']").prop("disabled",!1),a.ajaxUpload()):a.form.find("input[type='submit']").parent().parent().before('<div data-dismiss="alert" class="alert alert-danger">You must select at least one category before you can proceed<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button></div>'):a.form.find("input[type='submit']").parent().parent().before('<div data-dismiss="alert" class="alert alert-danger">You must add a cover image before you can proceed<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button></div>')})},ajaxUpload:function(){var a=this;$.ajax(a.form.attr("action"),{type:"post",data:a.form.serialize(),dataType:"json",beforeSend:function(){a.form.find("input[type='submit']").prop("disabled",!0).after('<span id="class-loading" class="icon icon-loading ml10"></span>')},success:function(a){window.location.href=a.url},error:function(a,t,i){console.log(a+" - "+t+" - "+i)},complete:function(){$("#class-loading").remove(),console.log("complete")}})},reValidate:function(){$("input[name='image']").val()&&$("input[name='category_array[]']").val()&&this.form.find("input[type='submit']").prop("disabled",!1)}};
function UpdateSessions(t){this.form=t,self.data="",this.init()}UpdateSessions.prototype={constructor:UpdateSessions,init:function(){this.addListeners()},addListeners:function(){$(document).on("submit","#update-sessions",$.proxy(this.submitUpdate,this))},submitUpdate:function(t){t.preventDefault(),this.ajaxUpload()},ajaxUpload:function(){var t=this;t.data=t.form.serialize(),$.ajax(t.form.attr("action"),{type:"post",data:t.data,dataType:"json",beforeSend:function(){t.form.find("input[type='submit']").prop("disabled",!0).append('<span id="sessionupdate-loading" class="icon icon-loading ml10 mt10"></span>')},success:function(t){window.location.href=t.url},error:function(){console.log("error")},complete:function(){t.form.find("input[type='submit']").prop("disabled",!1),$("#sessionupdate-loading").remove()}})}};
function previewBox(t){this.box=t,this.height=this.box.height(),this.heroTop=$(".hero").css("margin-top").replace("px",""),this.init()}previewBox.prototype={constructor:previewBox,init:function(){$("#nav").css("margin-top",this.height),console.log(parseInt(this.heroTop)+parseInt(this.height)),$(".hero").css("margin-top",parseInt(this.heroTop)+parseInt(this.height))}};
var Profile=function(t){this.nav=t,this.top=0,this.speed=400,this.init()};Profile.prototype={constructor:Profile,init:function(){this.top=Math.floor(this.nav.offset().top-this.nav.outerHeight(!0));var t=this;$(document).on("click",".nav-pills li a",function(){destination=$(this).attr("href"),$(".nav-pills li").removeClass("active"),$(this).parent().addClass("active"),$(".profile-panels").addClass("hidden"),$(destination).removeClass("hidden"),new Masonry($(".masonry")),t.scroll()})},scroll:function(){}};
var Masonry=function(n){this.masonry=n,this.init()};Masonry.prototype={constructor:Masonry,init:function(){var n=this.masonry;n.masonry({itemSelector:".masonry-item",isInitLayout:!0,transitionDuration:0}),n.masonry}};
var ToggleSwitch=function(t){this.toggle=t,this.originalClass=t.data("removeclass"),this.switchClass=t.data("switchclass"),this.originalText=t.text(),this.switchText=t.data("switchtext"),this.init()};ToggleSwitch.prototype={constructor:ToggleSwitch,init:function(){this.toggle.text(this.switchText),this.toggle.addClass(this.switchClass),this.toggle.removeClass(this.originalClass),this.toggle.data("switchtext",this.originalText),this.toggle.data("removeclass",this.switchClass),this.toggle.data("switchclass",this.originalClass)}};
function Map(a){this.lat=a.data("lat"),this.lng=a.data("lng"),this.zoom=a.data("zoom"),this.icon="/assets/img/icon_default_small_pin.png",this.init()}Map.prototype={constructor:Map,init:function(){var a=document.createElement("script");a.src="http://www.google.com/jsapi?key=AIzaSyAha5JzFciZvU_rWu_2d2UVl7o4Z8LWdcg&callback=map.load",a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a)},load:function(){self=this,google.load("maps","3",{other_params:"sensor=false",callback:function(){var a=new google.maps.Map(document.getElementById("map_canvas"),{center:new google.maps.LatLng(self.lat,self.lng),zoom:self.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP});google.maps.event.trigger(a,"resize");var e=new google.maps.Marker({position:new google.maps.LatLng(self.lat,self.lng),animation:google.maps.Animation.DROP,icon:self.icon});e.setMap(a)}})}};
var AjaxRequest=function(t,a){this.form=t,this.actionUrl=t.attr("action"),this.method=t.attr("method"),this.data=t.serialize(),this.dataType="json",this.validationScrollSpeed=200,this.validationoffset=85,this.validationscroll=!1,this.callbackname=a,this.disableButton(),this.init()};AjaxRequest.prototype={constuctor:AjaxRequest,init:function(){self=this,$.ajax({url:self.actionUrl,type:self.method,data:self.data,dataType:self.dataType}).done(function(t){self.callbackSelctor(t)})},disableButton:function(){this.form.find('input[type="submit"]').prop("disabled",!0)},renableButton:function(){this.form.find('input[type="submit"]').prop("disabled",!1)},callbackSelctor:function(t){"error"==t.callback?self.failedValidation(t):self.callbackname(t)},failedValidation:function(t){self=this;var a=t.errors;"login-form"==self.form.attr("id")?self.form.find("input[name = 'password']").after('<div class="mt10 alert alert-danger alert-dismissible" role="alert">'+a+'<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button></div>'):$.each(a,function(t,a){0==self.validationscroll&&(self.form.find("#"+t).focus(),$("html, body").animate({scrollTop:self.form.find("#"+t).offset().top-self.validationoffset},self.validationScrollSpeed),self.validationscroll=!0),self.form.find("#"+t).parent().addClass("has-error"),self.form.find("#"+t).parent().find(".glyphicon-ok").remove(),self.form.find("#"+t).after('<small class="help-block" data-bv-validator="notEmpty" data-bv-for="'+t+'" data-bv-result="INVALID">'+a+"</small>"),self.form.find("#"+t).after('<i class="form-control-feedback glyphicon glyphicon-remove" data-bv-icon-for="'+t+'" style="display: block;"></i>')}),self.renableButton()}};
var ImagePlaceholder=function(){this.colour="#ebedee",this.size=0,this.themes()};ImagePlaceholder.prototype={constructor:ImagePlaceholder,themes:function(){self=this,Holder.addTheme("upload",{background:self.colour,foreground:self.colour,size:self.size})}};
var PreviewClassBox=function(s){this.box=s,this.boxClass=s.attr("class"),this.id=s.attr("id")};
function Cart(t){this.cart=t,this.addTo=$(".add-to-class"),this.watch()}Cart.prototype={constructor:Cart,watch:function(){var t=this;$(document).on("submit","#empty-cart",function(o){t.submit($("#empty-cart"),o)}),$(document).on("submit",".remove-row",function(o){t.submit($(".remove-row"),o)}),this.addTo.on("submit",function(o){t.submit($(this),o)})},submit:function(t,o){o.preventDefault(),o.stopPropagation(),new AjaxRequest(t,cart.updateCart)},updateCart:function(t){$(".dropdown ").addClass("open"),$(".dropdown-cart").replaceWith(t.view)}};
function AddSessions(t){this.form=t,this.calendar=this.form.find("#calendar"),this.daysOfWeek="",this.dates=[],this.submitDates=[],this.index="",this.recur="no",this.recurring=6,this.recurringFor=this.form.find("#recurring-days").val(),this.rows=[],this.currentDates=[],this.init()}AddSessions.prototype={constructor:AddSessions,init:function(){this.calendar.datepicker({format:"yyyy-mm-dd",startDate:"+1d",todayHighlight:!0,multidate:!0}),this.daysOfWeek=this.calendar.find(".dow"),this.addListener()},addListener:function(){this.daysOfWeek.on("click",$.proxy(this.dayOfWeek,this)),$('input[name="recurring"]').on("change",$.proxy(this.recurringCheck,this)),this.form.on("submit",$.proxy(this.submitForm,this)),this.form.find("#recurring-days").on("change",$.proxy(this.changeRecurringFor,this))},dayOfWeek:function(t){this.index=$(t.target).index(),this.rows=[],this.setdayOfWeeks()},setdayOfWeeks:function(){this.currentDates=this.calendar.datepicker("getDates");var t=new Date,e=t.getMonth(),s=this;for(t.setDate(1);t.getDay()!==this.index;)t.setDate(t.getDate()+1);for(;t.getMonth()===e;)s.dates.push(new Date(t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate())),t.setDate(t.getDate()+7);this.setCalendarDates()},recurringDates:function(){this.currentDates=this.calendar.datepicker("getDates");var t=this;$.each(this.currentDates,function(e,s){t.dates.push(s);var a=Math.ceil(s.getDate()/7),i=s.getDay(),r=s.getMonth()+1;t.setRecurringDays(i,r,a)})},submitForm:function(t){t.preventDefault();var e=this;$.each(this.calendar.datepicker("getDates"),function(t,s){var a=s.getDate(),i=s.getMonth()+1,r=s.getFullYear();e.submitDates.push(r+"-"+i+"-"+a)}),$('input[name="session_array"]').val(this.submitDates),this.ajaxUpload()},ajaxUpload:function(){var t=this;$.ajax(t.form.attr("action"),{type:"post",data:t.form.serialize(),dataType:"json",beforeSend:function(){t.form.find("input[type='submit']").prop("disabled",!0).parent().after('<span id="session-loading" class="icon icon-loading ml10 mt10"></span>')},success:function(e){$("#update-session").html(e.view),t.dates=[],t.submitDates=[],t.setCalendarDates(),$("html, body").animate({scrollTop:$("#update-container").offset().top-20},1e3)},error:function(){console.log("error")},complete:function(){t.form.find("input[type='submit']").prop("disabled",!1),$("#session-loading").remove()}})},setRecurringDays:function(t,e,s){for(var a=this,i=0;i<a.recurringFor;i++){var r=new Date;for(r.setMonth(e+i),r.setDate(1);r.getDay()!==t;)r.setDate(r.getDate()+1);for(;Math.ceil(r.getDate()/7)!==s;)r.setDate(r.getDate()+7);a.dates.push(new Date(r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()))}this.setCalendarDates()},recurringCheck:function(t){"yes"==$(t.target).val()?(this.recur="yes",this.recurringDates()):(this.recur="no",this.resetCalendarDates())},setCalendarDates:function(){this.calendar.datepicker("setDates",this.dates)},resetCalendarDates:function(){this.calendar.datepicker("setDates",this.currentDates)},changeRecurringFor:function(t){this.recurringFor=$(t.target).val(),"yes"==this.recur&&this.calendar.datepicker("setDates",this.currentDates),$('input[name="recurring"][value="'+this.recur+'"]').trigger("change")}};